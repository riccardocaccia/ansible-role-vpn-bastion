# -------------------------
# Which Identity Provider configuration to use.
# Allowed values: iam | lifescience | egi
# -------------------------
idp_provider: "iam"

# -------------------------
# OIDC endpoints per provider.
# - IAM is fully populated.
# - lifescience and egi are placeholders to be filled with official endpoints.
# -------------------------
oidc_providers:
  iam:
    device_endpoint:   "https://iam.recas.ba.infn.it/devicecode"
    token_endpoint:    "https://iam.recas.ba.infn.it/token"
    userinfo_endpoint: "https://iam.recas.ba.infn.it/userinfo"
  lifescience:
    device_endpoint:   "FILL_ME"  # e.g. https://aai.lifescience-ri.eu/devicecode
    token_endpoint:    "FILL_ME"
    userinfo_endpoint: "FILL_ME"
  egi:
    device_endpoint:   "FILL_ME"  # e.g. https://aai.egi.eu/devicecode
    token_endpoint:    "FILL_ME"
    userinfo_endpoint: "FILL_ME"

# -------------------------
# Public OIDC client fields (OK to keep outside Vault).
# client_secret must go in bastion.vault.yml
# -------------------------
username_attribute: "preferred_username"

# Optional group-based access control. Empty list disables the check.
allowed_groups: []

# -------------------------
# Optional email delivery of device code/URL.
# If enable_email is true, set SMTP username here and SMTP password in Vault.
# -------------------------
enable_email: false
smtp:
  smtp_server_url: "smtps://smtp.gmail.com:465"
  smtp_username: ""            # if you enable email, put the username here (non-secret)
  smtp_insecure: "false"
  smtp_ca_path: ""
  from_address: "vpn@example.com"
  from_username: "noreply@infn-cloud-vpn"
  cc_address: ""

# -------------------------
# QR code configuration (-1 = do not print QR)
# -------------------------
qr_error_correction_level: -1

# -------------------------
# Extra verbosity in PAM module (stdout)
# -------------------------
pam_debug: true

# -------------------------
# Source/build/install locations for the PAM module
# -------------------------
pam_module_repo: "https://github.com/Laniakea-elixir-it/pam_oauth2_device"
pam_module_dest: "/opt/pam_oauth2_device"
pam_module_so: "/usr/lib/x86_64-linux-gnu/security/pam_oauth2_device.so"
pam_config_dir: "/etc/pam_oauth2_device"
pam_config_path: "/etc/pam_oauth2_device/config.json"

# Build/runtime dependencies for Ubuntu 22.04
pam_build_deps:
  - git
  - make
  - gcc
  - build-essential
  - libcurl4-nss-dev
  - libpam0g-dev
  - qrencode

# -------------------------
# SSH/PAM integration â€“ non-destructive (keeps other auth methods)
# -------------------------
sshd_config_file: "/etc/ssh/sshd_config"
pam_sshd_file: "/etc/pam.d/sshd"
insert_pam_line: 'auth required pam_oauth2_device.so /etc/pam_oauth2_device/config.json'

# -------------------------
# Create a technical "jump" user for automation (IM) and install a public key
# -------------------------
jump_user: "im"
